---

- name: if LXD exists
  shell: "which lxd"
  register: exists
  failed_when: false
  ignore_errors: true

- name: Install LXD using Snapcraft
  block:
  - name: Installation
    community.general.snap:
      name:
        - lxd
    become: true
    notify:
      - restart.os
      - ask manually restart

  - name: allow non-root user
    user:
      name: '{{ansible_user}}'
      groups: lxd
      append: yes
    become: true

  - meta: flush_handlers

  - name: manually restart if local
    meta: end_host
    when: ansible_connection == 'local'
  when: exists.rc != 0


# https://ubuntu.com/server/docs/containers-lxd
